This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.claude/settings.local.json
backend/.env.example
backend/.gitignore
backend/package.json
backend/schema.sql
backend/src/config/db.js
backend/src/controllers/authController.js
backend/src/controllers/storeController.js
backend/src/middleware/authMiddleware.js
backend/src/routes/authRoutes.js
backend/src/routes/storeRoutes.js
backend/src/server.js
backend/src/utils/emailservice.js
backend/src/utils/validation.js
frontend/.gitignore
frontend/eslint.config.js
frontend/index.html
frontend/package.json
frontend/postcss.config.js
frontend/README.md
frontend/src/@types/index.ts
frontend/src/App.tsx
frontend/src/components/layout/AuthLayout.tsx
frontend/src/components/layout/Logo.tsx
frontend/src/components/ProtectedRoute.tsx
frontend/src/components/ui/Button.tsx
frontend/src/components/ui/Input.tsx
frontend/src/context/AuthContext.tsx
frontend/src/index.css
frontend/src/main.tsx
frontend/src/pages/AdminDashboard.tsx
frontend/src/pages/ComponentTestPage.tsx
frontend/src/pages/CustomerDashboard.tsx
frontend/src/pages/ForgotPasswordPage.tsx
frontend/src/pages/LoginPage.tsx
frontend/src/pages/MerchantDashboard.tsx
frontend/src/pages/MerchantPendingApprovalPage.tsx
frontend/src/pages/MerchantRejectedPage.tsx
frontend/src/pages/MyRatingsPage.tsx
frontend/src/pages/RegisterMerchantPage.tsx
frontend/src/pages/ResetPasswordPage.tsx
frontend/src/pages/StoreReviewsPage.tsx
frontend/src/pages/VerifyEmailPage.tsx
frontend/src/services/api.ts
frontend/tailwind.config.js
frontend/tsconfig.app.json
frontend/tsconfig.json
frontend/tsconfig.node.json
frontend/vite.config.ts
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="backend/.env.example">
PORT=5000
DATABASE_URL=postgresql://postgres:Superking04@localhost:5432/Replate

JWT_SECRET= replatejwttoken
JWT_EXPIRE=2h

#Email Configuration
# EMAIL_USER = mactower0@gmail.com
# EMAIL_PASS = oajohkgdcgesskji
# FRONTEND_URL = http://localhost:5173



NODE_ENV=development
</file>

<file path=".claude/settings.local.json">
{
  "permissions": {
    "allow": [
      "Bash(tree:*)"
    ]
  }
}
</file>

<file path="backend/src/controllers/storeController.js">
const pool = require('../config/db');

const getMerchantStore = async(req,res) => {
    try {
        const merchantId = req.user.userId;

        //verify user is a merchant
        if(req.user.role !== 'merchant'){
            return res.status(403).json({
                success: false,
                message: "Access forbidden. You do not have the required role."
            });
        }

        const result = await pool.query(
            `SELECT
                store_id,
                merchant_id,
                store_name,
                description,
                address,
                city,
                latitude,
                longtitude,
                phone,
                operating_hours,
                logo_url,
                banner_url,
                bank_account_number,
                qris_image_url,
                is_active,
                appoval_status,
                admin_notes,
                approved_at,
                approved_by,
                created_at,
                updated_ad
                FROM stores
                WHERE merchant_id = $1`, [merchantId]
        );

        //check if store exists
        if(result.rows.length === 0){
            return res.status(404).json({
                success: false,
                message: "Merchant store not found"
            });
        }

        res.status(200).json({
            success: true,
            data: result.rows[0]
        });


    } catch (error) {
        console.error('Error fetching merchant store:', error);
        res.status(500).json({
            success: false,
            message: "Internal server error"
        });
    }
};

module.exports = {
    getMerchantStore
};
</file>

<file path="backend/src/routes/authRoutes.js">
const express = require('express');
const router = express.Router();

const{
    registerUser,
    RegisterMerchant,
    registerStoreInfo,
    registerStoreVerification,
    login,
    getProfile,
    verifyEmail,
    resendVerification,
    forgotPassword,
    resetPassword
} = require('../controllers/authController');
const {verifyToken} = require('../middleware/authMiddleware');

//register routes
router.post('/register/user', registerUser);
router.post('/register/store/merchant', RegisterMerchant);
router.post('/register/store/info', verifyToken, registerStoreInfo);
router.post('/register/store/verification', verifyToken,registerStoreVerification);
router.post('/verify-email', verifyEmail);
router.post('/resend-verification', resendVerification);
router.post('/forgot-password', forgotPassword);
router.post('/reset-password', resetPassword);

router.post('/login', login);
router.get('/profile', verifyToken, getProfile);

module.exports = router;
</file>

<file path="backend/src/routes/storeRoutes.js">
const express = require('express');
const router = express.Router();

//Import middleware
const { verifyToken } = require('../middleware/authMiddleware');
//Import controller
const { getMerchantStore } = require('../controllers/storeController');

router.get('/merchant/store', verifyToken, getMerchantStore);

module.exports = router;
</file>

<file path="frontend/.gitignore">
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?
.env
</file>

<file path="frontend/eslint.config.js">
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import tseslint from 'typescript-eslint'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      js.configs.recommended,
      tseslint.configs.recommended,
      reactHooks.configs.flat.recommended,
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
    },
  },
])
</file>

<file path="frontend/index.html">
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>frontend</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
</file>

<file path="frontend/postcss.config.js">
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}
</file>

<file path="frontend/README.md">
# React + TypeScript + Vite

This template provides a minimal setup to get React working in Vite with HMR and some ESLint rules.

Currently, two official plugins are available:

- [@vitejs/plugin-react](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react) uses [Babel](https://babeljs.io/) (or [oxc](https://oxc.rs) when used in [rolldown-vite](https://vite.dev/guide/rolldown)) for Fast Refresh
- [@vitejs/plugin-react-swc](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react-swc) uses [SWC](https://swc.rs/) for Fast Refresh

## React Compiler

The React Compiler is not enabled on this template because of its impact on dev & build performances. To add it, see [this documentation](https://react.dev/learn/react-compiler/installation).

## Expanding the ESLint configuration

If you are developing a production application, we recommend updating the configuration to enable type-aware lint rules:

```js
export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      // Other configs...

      // Remove tseslint.configs.recommended and replace with this
      tseslint.configs.recommendedTypeChecked,
      // Alternatively, use this for stricter rules
      tseslint.configs.strictTypeChecked,
      // Optionally, add this for stylistic rules
      tseslint.configs.stylisticTypeChecked,

      // Other configs...
    ],
    languageOptions: {
      parserOptions: {
        project: ['./tsconfig.node.json', './tsconfig.app.json'],
        tsconfigRootDir: import.meta.dirname,
      },
      // other options...
    },
  },
])
```

You can also install [eslint-plugin-react-x](https://github.com/Rel1cx/eslint-react/tree/main/packages/plugins/eslint-plugin-react-x) and [eslint-plugin-react-dom](https://github.com/Rel1cx/eslint-react/tree/main/packages/plugins/eslint-plugin-react-dom) for React-specific lint rules:

```js
// eslint.config.js
import reactX from 'eslint-plugin-react-x'
import reactDom from 'eslint-plugin-react-dom'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      // Other configs...
      // Enable lint rules for React
      reactX.configs['recommended-typescript'],
      // Enable lint rules for React DOM
      reactDom.configs.recommended,
    ],
    languageOptions: {
      parserOptions: {
        project: ['./tsconfig.node.json', './tsconfig.app.json'],
        tsconfigRootDir: import.meta.dirname,
      },
      // other options...
    },
  },
])
```
</file>

<file path="frontend/src/components/layout/AuthLayout.tsx">
import type { ReactNode } from 'react';
import Logo from './Logo';

interface AuthLayoutProps {
  children: ReactNode;
  title?: string;
  subtitle?: string;
}

export default function AuthLayout({ children, title, subtitle }: AuthLayoutProps) {
  return (
    <div className="min-h-screen bg-gradient-to-r from-[#217851] to-[#135252] flex items-center justify-center p-4">
      <div className="w-full max-w-md">
        {/* White Card */}
        <div className="bg-white rounded-2xl shadow-xl p-8 md:p-10">
          {/* Logo */}
          <div className="mb-8 text-center">
            <Logo size="medium" />
          </div>

          {/* Title & Subtitle (optional) */}
          {(title || subtitle) && (
            <div className="mb-6 text-center">
              {title && (
                <h2 className="text-2xl font-bold text-gray-800 mb-2">
                  {title}
                </h2>
              )}
              {subtitle && (
                <p className="text-gray-600 text-sm">
                  {subtitle}
                </p>
              )}
            </div>
          )}

          {/* Content */}
          <div>{children}</div>
        </div>

        {/* Footer text (optional) */}
        <p className="text-center text-sm text-gray-600 mt-6">
          © 2025 Replate. All rights reserved.
        </p>
      </div>
    </div>
  );
}
</file>

<file path="frontend/src/components/layout/Logo.tsx">
import { Link } from 'react-router-dom';

interface LogoProps {
  size?: 'small' | 'medium' | 'large';
  className?: string;
}

export default function Logo({ size = 'medium', className = '' }: LogoProps) {
  // Size classes untuk SVG logo
  const logoSizes = {
    small: 'w-8 h-8',
    medium: 'w-12 h-12',
    large: 'w-16 h-16'
  };

  // Size classes untuk text
  const textSizeClasses = {
    small: 'text-xl',
    medium: 'text-2xl md:text-3xl',
    large: 'text-3xl md:text-4xl lg:text-5xl'
  };

  const taglineClasses = {
    small: 'text-xs',
    medium: 'text-sm',
    large: 'text-base md:text-lg'
  };

  return (
    <Link to="/" className={`inline-block ${className}`}>
      <div className="flex items-center gap-3">
        {/* Logo SVG */}
        <svg 
          className={logoSizes[size]} 
          viewBox="0 0 95 100" 
          fill="none" 
          xmlns="http://www.w3.org/2000/svg"
        > {/* Convert X dan Y ke top bottom left right */}
          <rect x="1.5" y="1.5" width="92" height="97" rx="13.5" fill="#2D7A5E" stroke="white" strokeWidth="3"/>
          <path d="M18.4559 18.7171C17.2093 20.6185 16.902 22.954 17.3836 25.6512C17.9579 28.8677 19.6955 32.4923 22.2071 35.9051C27.2304 42.7308 35.3389 48.6312 42.5526 49.5257L43.0568 49.59L43.3815 49.9788L69.9262 82.0223C72.5719 82.6545 74.2802 82.2608 75.1685 81.3811C76.0636 80.4946 76.4763 78.7827 75.8134 76.0662L18.4562 18.717L18.4559 18.7171ZM69.7342 19.0332L54.9002 33.8672C53.2596 35.5075 53.2454 37.3125 54.0925 39.2847L54.4429 40.1009L53.802 40.7161L48.8203 45.467L52.8664 49.5129L57.596 44.5183L58.2113 43.8688L59.0272 44.2235C61.1005 45.117 63.0667 45.0803 64.59 43.557L79.424 28.723L77.4971 26.7961L67.8498 36.4391L66.0469 34.6321L75.6897 24.9894L73.6348 22.9338L63.992 32.5768L62.1846 30.7697L71.8274 21.1269L69.7342 19.0332ZM41.8389 52.1278L16.4905 76.3141C15.865 78.9049 16.2657 80.5233 17.1101 81.3597C17.9547 82.1962 19.5885 82.5802 22.1473 81.9621L45.8298 56.9471L41.8389 52.1278Z" fill="white"/>
        </svg>
        
        {/* Text Container */}
        <div>
          {/* Brand Name */}
          <h1 className={`text-start font-bold text-primary ${textSizeClasses[size]} leading-none`}>
            Replate
          </h1>
          
          {/* Tagline */}
          <p className={`text-gray-600 font-medium ${taglineClasses[size]} mt-0.5`}>
            Rescue. Reduce. Replate.
          </p>
        </div>
      </div>
    </Link>
  );
}
</file>

<file path="frontend/src/components/ProtectedRoute.tsx">
import type { ReactNode } from 'react';
import { Navigate } from 'react-router-dom';
import { useAuth } from '../context/AuthContext';

interface ProtectedRouteProps {
  children: ReactNode;
  allowedRoles: ('user' | 'merchant' | 'admin')[];
}

export default function ProtectedRoute({ children, allowedRoles }: ProtectedRouteProps) {
  const { user, isAuthenticated, isLoading } = useAuth();

  // Show loading state
  if (isLoading) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-gray-50">
        <div className="text-center">
          <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"></div>
          <p className="text-gray-600">Loading...</p>
        </div>
      </div>
    );
  }

  // Not authenticated - redirect to login
  if (!isAuthenticated || !user) {
    return <Navigate to="/login" replace />;
  }

  // Check if user role is allowed
  if (!allowedRoles.includes(user.role)) {
    // Redirect to correct dashboard based on role
    if (user.role === 'user') {
      return <Navigate to="/dashboard" replace />;
    } else if (user.role === 'merchant') {
      return <Navigate to="/merchant/dashboard" replace />;
    } else if (user.role === 'admin') {
      return <Navigate to="/admin/dashboard" replace />;
    }
    return <Navigate to="/login" replace />;
  }

  // Authorized - render children
  return <>{children}</>;
}
</file>

<file path="frontend/src/components/ui/Button.tsx">
import type { ButtonHTMLAttributes, ReactNode } from 'react';
import { Loader2 } from 'lucide-react';

interface ButtonProps extends ButtonHTMLAttributes<HTMLButtonElement> {
  children: ReactNode;
  variant?: 'primary' | 'secondary' | 'outline' | 'ghost';
  size?: 'small' | 'medium' | 'large';
  isLoading?: boolean;
  leftIcon?: ReactNode;
  rightIcon?: ReactNode;
  fullWidth?: boolean;
}

export default function Button({
  children,
  variant = 'primary',
  size = 'medium',
  isLoading = false,
  leftIcon,
  rightIcon,
  fullWidth = false,
  disabled,
  className = '',
  ...props
}: ButtonProps) {
  // Base classes
  const baseClasses = 'inline-flex items-center justify-center font-medium rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2';

  // Variant classes
  const variantClasses = {
    primary: 'bg-primary text-white hover:bg-primary-dark focus:ring-primary disabled:bg-gray-300 disabled:cursor-not-allowed',
    secondary: 'bg-gray-200 text-gray-800 hover:bg-gray-300 focus:ring-gray-400 disabled:bg-gray-100 disabled:text-gray-400 disabled:cursor-not-allowed',
    outline: 'border-2 border-primary text-primary hover:bg-primary hover:text-white focus:ring-primary disabled:border-gray-300 disabled:text-gray-300 disabled:cursor-not-allowed',
    ghost: 'text-gray-700 hover:bg-gray-100 focus:ring-gray-400 disabled:text-gray-300 disabled:cursor-not-allowed'
  };

  // Size classes
  const sizeClasses = {
    small: 'px-3 py-1.5 text-sm gap-1.5',
    medium: 'px-4 py-2 text-base gap-2',
    large: 'px-6 py-3 text-lg gap-2.5'
  };

  // Width class
  const widthClass = fullWidth ? 'w-full' : '';

  // Disabled state
  const isDisabled = disabled || isLoading;

  return (
    <button
      className={`
        ${baseClasses}
        ${variantClasses[variant]}
        ${sizeClasses[size]}
        ${widthClass}
        ${className}
      `}
      disabled={isDisabled}
      {...props}
    >
      {/* Loading spinner */}
      {isLoading && (
        <Loader2 className="animate-spin" size={size === 'small' ? 14 : size === 'large' ? 20 : 16} />
      )}

      {/* Left icon */}
      {!isLoading && leftIcon && (
        <span className="inline-flex">{leftIcon}</span>
      )}

      {/* Button text */}
      <span>{children}</span>

      {/* Right icon */}
      {!isLoading && rightIcon && (
        <span className="inline-flex">{rightIcon}</span>
      )}
    </button>
  );
}
</file>

<file path="frontend/src/components/ui/Input.tsx">
import type { InputHTMLAttributes, ReactNode} from 'react';
import { forwardRef } from 'react';
import { useState } from 'react';
import { Eye, EyeOff } from 'lucide-react';

interface InputProps extends InputHTMLAttributes<HTMLInputElement> {
  label?: string;
  error?: string;
  leftIcon?: ReactNode;
  helperText?: string;
  isPassword?: boolean;
}

const Input = forwardRef<HTMLInputElement, InputProps>(
  (
    {
      label,
      error,
      leftIcon,
      helperText,
      isPassword = false,
      type = 'text',
      className = '',
      disabled,
      ...props
    },
    ref
  ) => {
    const [showPassword, setShowPassword] = useState(false);

    // Determine input type
    const inputType = isPassword ? (showPassword ? 'text' : 'password') : type;

    // Base classes
    const baseClasses = 'w-full px-4 py-2 border rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2';

    // State classes
    const stateClasses = error
      ? 'border-red-500 focus:ring-red-500 focus:border-red-500'
      : 'border-gray-300 focus:ring-primary focus:border-primary';

    // Disabled classes
    const disabledClasses = disabled
      ? 'bg-gray-100 text-gray-500 cursor-not-allowed'
      : 'bg-white text-gray-900';

    // Icon padding
    const iconPadding = leftIcon ? 'pl-11' : '';

    return (
      <div className="w-full">
        {/* Label */}
        {label && (
          <label className="block text-sm font-medium text-gray-700 mb-1.5">
            {label}
            {props.required && <span className="text-red-500 ml-1">*</span>}
          </label>
        )}

        {/* Input wrapper */}
        <div className="relative">
          {/* Left icon */}
          {leftIcon && (
            <div className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">
              {leftIcon}
            </div>
          )}

          {/* Input field */}
          <input
            ref={ref}
            type={inputType}
            className={`
              ${baseClasses}
              ${stateClasses}
              ${disabledClasses}
              ${iconPadding}
              ${className}
            `}
            disabled={disabled}
            {...props}
          />

          {/* Password toggle */}
          {isPassword && (
            <button
              type="button"
              onClick={() => setShowPassword(!showPassword)}
              className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 focus:outline-none"
              tabIndex={-1}
            >
              {showPassword ? (
                <EyeOff size={20} />
              ) : (
                <Eye size={20} />
              )}
            </button>
          )}
        </div>

        {/* Helper text or error message */}
        {(helperText || error) && (
          <p className={`mt-1.5 text-sm ${error ? 'text-red-500' : 'text-gray-500'}`}>
            {error || helperText}
          </p>
        )}
      </div>
    );
  }
);

Input.displayName = 'Input';

export default Input;
</file>

<file path="frontend/src/context/AuthContext.tsx">
import { createContext, useContext, useState, useEffect, type ReactNode } from 'react';
import type { User } from '../@types';
import { getToken, getUser, setToken as saveToken, setUser as saveUser, logout as logoutUser } from '../services/api';

interface AuthContextType {
  user: User | null;
  token: string | null;
  login: (user: User, token: string) => void;
  logout: () => void;
  isAuthenticated: boolean;  // ← FIX: typo (was isAutenticated)
  isLoading: boolean;
}

const AuthContext = createContext<AuthContextType | undefined>(undefined);

export const useAuth = () => {
  const context = useContext(AuthContext);
  if (!context) {
    throw new Error('useAuth must be used within AuthProvider');
  }
  return context;
};

interface AuthProviderProps {
  children: ReactNode;
}

export function AuthProvider({ children }: AuthProviderProps) {  // ← FIX: children (lowercase)
  const [user, setUser] = useState<User | null>(null);
  const [token, setToken] = useState<string | null>(null);
  const [isLoading, setIsLoading] = useState(true);

  // ← FIX: useEffect INSIDE component
  useEffect(() => {
    const storedToken = getToken();
    const storedUser = getUser();

    if (storedToken && storedUser) {
      setToken(storedToken);
      setUser(storedUser);
    }

    setIsLoading(false);
  }, []);

  // ← FIX: Functions INSIDE component
  const handleLogin = (newUser: User, newToken: string) => {
    setUser(newUser);
    setToken(newToken);
    saveToken(newToken);
    saveUser(newUser);
  };

  const handleLogout = () => {
    setUser(null);
    setToken(null);
    logoutUser();
  };

  // ← FIX: Return statement
  return (
    <AuthContext.Provider
      value={{
        user,
        token,
        login: handleLogin,
        logout: handleLogout,
        isAuthenticated: !!token && !!user,  // ← FIX: typo & check both
        isLoading,
      }}
    >
      {children}  {/* ← FIX: lowercase children */}
    </AuthContext.Provider>
  );
}
</file>

<file path="frontend/src/pages/AdminDashboard.tsx">
export default function AdminDashboard() {
    return (
      <div className="min-h-screen bg-gray-50">
        <div className="max-w-7xl mx-auto px-4 py-8">
          <h1 className="text-3xl font-bold text-gray-800 mb-2">Admin Dashboard</h1>
          <p className="text-gray-600">Placeholder - Will be built in Phase 4.3.2</p>
          <div className="mt-4 p-4 bg-purple-50 border border-purple-200 rounded-lg">
            <p className="text-sm text-purple-800">
              ✅ Protected Route - Only accessible by admin (role: 'admin')
            </p>
          </div>
        </div>
      </div>
    );
  }
</file>

<file path="frontend/src/pages/ComponentTestPage.tsx">
import { useState } from 'react';
import { Mail, Lock, User, Search } from 'lucide-react';
import Logo from '../components/layout/Logo';
import Button from '../components/ui/Button';
import Input from '../components/ui/Input';
import AuthLayout from '../components/layout/AuthLayout';


export default function ComponentTestPage() {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [loading, setLoading] = useState(false);

  const handleTest = () => {
    setLoading(true);
    setTimeout(() => setLoading(false), 2000);
  };

  

  return (
    
    <div className="min-h-screen bg-gray-50 p-8">
      <div className="max-w-6xl mx-auto">
        <h1 className="text-4xl font-bold text-gray-800 mb-8">
          Component Test Page
        </h1>

        {/* Logo Test */}
        <section className="mb-12 bg-white p-8 rounded-lg shadow">
          <h2 className="text-2xl font-bold mb-4">Logo Component</h2>
          <div className="space-y-6">
            <div>
              <p className="text-sm text-gray-600 mb-2">Small:</p>
              <Logo size="small" />
            </div>
            <div>
              <p className="text-sm text-gray-600 mb-2">Medium:</p>
              <Logo size="medium" />
            </div>
            <div>
              <p className="text-sm text-gray-600 mb-2">Large:</p>
              <Logo size="large" />
            </div>
          </div>
        </section>

        {/* Button Test */}
        <section className="mb-12 bg-white p-8 rounded-lg shadow">
          <h2 className="text-2xl font-bold mb-4">Button Component</h2>
          
          {/* Variants */}
          <div className="mb-6">
            <p className="text-sm font-semibold text-gray-700 mb-3">Variants:</p>
            <div className="flex flex-wrap gap-3">
              <Button variant="primary">Primary</Button>
              <Button variant="secondary">Secondary</Button>
              <Button variant="outline">Outline</Button>
              <Button variant="ghost">Ghost</Button>
            </div>
          </div>

          {/* Sizes */}
          <div className="mb-6">
            <p className="text-sm font-semibold text-gray-700 mb-3">Sizes:</p>
            <div className="flex flex-wrap items-center gap-3">
              <Button size="small">Small</Button>
              <Button size="medium">Medium</Button>
              <Button size="large">Large</Button>
            </div>
          </div>

          {/* With Icons */}
          <div className="mb-6">
            <p className="text-sm font-semibold text-gray-700 mb-3">With Icons:</p>
            <div className="flex flex-wrap gap-3">
              <Button leftIcon={<Mail size={18} />}>With Left Icon</Button>
              <Button rightIcon={<Search size={18} />}>With Right Icon</Button>
              <Button leftIcon={<User size={18} />} rightIcon={<Search size={18} />}>
                Both Icons
              </Button>
            </div>
          </div>

          {/* States */}
          <div className="mb-6">
            <p className="text-sm font-semibold text-gray-700 mb-3">States:</p>
            <div className="flex flex-wrap gap-3">
              <Button onClick={handleTest} isLoading={loading}>
                {loading ? 'Loading...' : 'Click to Load'}
              </Button>
              <Button disabled>Disabled</Button>
            </div>
          </div>

          {/* Full Width */}
          <div>
            <p className="text-sm font-semibold text-gray-700 mb-3">Full Width:</p>
            <Button fullWidth>Full Width Button</Button>
          </div>
        </section>

        {/* Input Test */}
        <section className="mb-12 bg-white p-8 rounded-lg shadow">
          <h2 className="text-2xl font-bold mb-4">Input Component</h2>
          <div className="space-y-4 max-w-md">
            {/* Basic input */}
            <Input
              label="Email Address"
              type="email"
              placeholder="Enter your email"
              leftIcon={<Mail size={20} />}
              value={email}
              onChange={(e) => setEmail(e.target.value)}
            />

            {/* Password input */}
            <Input
              label="Password"
              isPassword
              placeholder="Enter your password"
              leftIcon={<Lock size={20} />}
              value={password}
              onChange={(e) => setPassword(e.target.value)}
            />

            {/* With helper text */}
            <Input
              label="Username"
              placeholder="Choose a username"
              helperText="Username must be unique"
              leftIcon={<User size={20} />}
            />

            {/* With error */}
            <Input
              label="Invalid Email"
              type="email"
              placeholder="test@example"
              error="Please enter a valid email address"
              leftIcon={<Mail size={20} />}
            />

            {/* Required field */}
            <Input
              label="Required Field"
              placeholder="This field is required"
              required
            />

            {/* Disabled */}
            <Input
              label="Disabled Input"
              placeholder="Cannot edit"
              disabled
              value="Disabled value"
            />
          </div>
        </section>

        {/* AuthLayout Test */}
        <section className="mb-12">
          <h2 className="text-2xl font-bold mb-4 bg-white p-4 rounded-lg shadow">
            AuthLayout Component (Full Page)
          </h2>
          <div className="border-4 border-dashed border-gray-300 rounded-lg overflow-hidden">
            <AuthLayout
              title="Welcome Back"
              subtitle="Sign in to continue to Replate"
            >
              <div className="space-y-4">
                <Input
                  label="Email"
                  type="email"
                  placeholder="Enter your email"
                  leftIcon={<Mail size={20} />}
                />
                <Input
                  label="Password"
                  isPassword
                  placeholder="Enter your password"
                  leftIcon={<Lock size={20} />}
                />
                <Button fullWidth>Sign In</Button>
              </div>
            </AuthLayout>
          </div>
        </section>
      </div>
    </div>
  );
}
</file>

<file path="frontend/src/pages/CustomerDashboard.tsx">
export default function CustomerDashboard() {
    return (
      <div className="min-h-screen bg-gray-50">
        <div className="max-w-7xl mx-auto px-4 py-8">
          <h1 className="text-3xl font-bold text-gray-800 mb-2">Customer Dashboard</h1>
          <p className="text-gray-600">Placeholder - Will be built in Phase 2.8.3</p>
          <div className="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
            <p className="text-sm text-blue-800">
              ✅ Protected Route - Only accessible by customers (role: 'user')
            </p>
          </div>
        </div>
      </div>
    );
  }
</file>

<file path="frontend/src/pages/ForgotPasswordPage.tsx">
import { useState } from 'react';
import { Link } from 'react-router-dom';
import { useForm } from 'react-hook-form';
import { Mail, ArrowLeft, CheckCircle } from 'lucide-react';
import toast from 'react-hot-toast';
import { forgotPassword } from '../services/api';
import AuthLayout from '../components/layout/AuthLayout';
import Input from '../components/ui/Input';
import Button from '../components/ui/Button';
import type { ForgotPasswordData } from '../@types';

export default function ForgotPasswordPage() {
  const [isLoading, setIsLoading] = useState(false);
  const [emailSent, setEmailSent] = useState(false);
  const [sentEmail, setSentEmail] = useState('');

  const {
    register,
    handleSubmit,
    formState: { errors }
  } = useForm<ForgotPasswordData>();

  const onSubmit = async (data: ForgotPasswordData) => {
    try {
      setIsLoading(true);

      // Call forgot password API
      await forgotPassword(data);

      // Success
      setEmailSent(true);
      setSentEmail(data.email);
      toast.success('Password reset email sent!');
    } catch (error: any) {
      console.error('Forgot password error:', error);
      toast.error(error.response?.data?.message || 'Failed to send reset email. Please try again.');
    } finally {
      setIsLoading(false);
    }
  };

  // Success state
  if (emailSent) {
    return (
      <AuthLayout>
        <div className="text-center">
          {/* Success Icon */}
          <div className="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <CheckCircle className="w-10 h-10 text-green-600" />
          </div>

          {/* Title */}
          <h2 className="text-2xl font-bold text-gray-800 mb-2">Check Your Email</h2>

          {/* Message */}
          <p className="text-gray-600 mb-6">
            We've sent a password reset link to:
            <br />
            <span className="font-semibold text-gray-800">{sentEmail}</span>
          </p>

          {/* Instructions */}
          <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6 text-left">
            <p className="text-sm text-blue-800">
              <strong>Next steps:</strong>
            </p>
            <ul className="text-sm text-blue-700 mt-2 space-y-1 list-disc list-inside">
              <li>Check your email inbox</li>
              <li>Click the reset password link</li>
              <li>Create a new password</li>
            </ul>
          </div>

          {/* Back to Login */}
          <Link to="/login">
            <Button variant="primary" size="medium" fullWidth leftIcon={<ArrowLeft size={18} />}>
              Back to Login
            </Button>
          </Link>

          {/* Resend option */}
          <p className="text-sm text-gray-500 mt-4">
            Didn't receive the email?{' '}
            <button
              onClick={() => {
                setEmailSent(false);
                setSentEmail('');
              }}
              className="text-primary hover:text-primary-dark font-semibold"
            >
              Try again
            </button>
          </p>
        </div>
      </AuthLayout>
    );
  }

  // Form state
  return (
    <AuthLayout title="Forgot Password?" subtitle="Enter your email to reset your password">
      <form onSubmit={handleSubmit(onSubmit)} className="space-y-4">
        {/* Email Input */}
        <Input
          label="Email Address"
          type="email"
          placeholder="Enter your email"
          leftIcon={<Mail size={20} />}
          error={errors.email?.message}
          helperText="We'll send you a password reset link"
          {...register('email', {
            required: 'Email is required',
            pattern: {
              value: /^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,
              message: 'Invalid email address'
            }
          })}
        />

        {/* Submit Button */}
        <Button
          type="submit"
          variant="primary"
          size="medium"
          fullWidth
          isLoading={isLoading}
        >
          {isLoading ? 'Sending...' : 'Send Reset Link'}
        </Button>

        {/* Back to Login */}
        <div className="text-center">
          <Link
            to="/login"
            className="inline-flex items-center gap-2 text-sm text-gray-600 hover:text-gray-800"
          >
            <ArrowLeft size={16} />
            Back to Login
          </Link>
        </div>
      </form>
    </AuthLayout>
  );
}
</file>

<file path="frontend/src/pages/LoginPage.tsx">
import { useState } from 'react';
import { useNavigate, Link } from 'react-router-dom';
import { useForm } from 'react-hook-form';
import { Mail, Lock, User, Phone, CheckCircle } from 'lucide-react';
import toast from 'react-hot-toast';
import { useAuth } from '../context/AuthContext';
import { login, getMerchantStore, registerCustomer } from '../services/api';
import AuthLayout from '../components/layout/AuthLayout';
import Input from '../components/ui/Input';
import Button from '../components/ui/Button';
import type { LoginCredentials, RegisterCustomerData } from '../@types';

type TabType = 'signin' | 'register';

export default function LoginPage() {
  const navigate = useNavigate();
  const { login: authLogin } = useAuth();
  const [activeTab, setActiveTab] = useState<TabType>('signin');
  const [isLoading, setIsLoading] = useState(false);
  const [registrationSuccess, setRegistrationSuccess] = useState(false);
  const [registeredEmail, setRegisteredEmail] = useState('');

  // Form for Sign In
  const {
    register: registerSignIn,
    handleSubmit: handleSubmitSignIn,
    formState: { errors: errorsSignIn }
  } = useForm<LoginCredentials>();

  // Form for Register
  const {
    register: registerForm,
    handleSubmit: handleSubmitRegister,
    watch,
    formState: { errors: errorsRegister }
  } = useForm<RegisterCustomerData>();

  const password = watch('password');

  // Sign In Handler
  const onSubmitSignIn = async (data: LoginCredentials) => {
    try {
      setIsLoading(true);

      const response = await login(data);
      authLogin(response.user, response.token);
      toast.success('Login successful!');

      if (response.user.role === 'user') {
        navigate('/dashboard');
      } else if (response.user.role === 'merchant') {
        try {
          const store = await getMerchantStore();

          if (store.approval_status === 'pending') {
            navigate('/merchant/pending-approval');
          } else if (store.approval_status === 'approved') {
            navigate('/merchant/dashboard');
          } else if (store.approval_status === 'rejected') {
            navigate('/merchant/rejected');
          }
        } catch (error) {
          navigate('/merchant/pending-approval');
        }
      } else if (response.user.role === 'admin') {
        navigate('/admin/dashboard');
      }
    } catch (error: any) {
      console.error('Login error:', error);

      const status = error.response?.status;
      const message = error.response?.data?.message;

      if (status === 404) {
        toast.error('No account found with this email address.');
      } else if (status === 401) {
        toast.error('Incorrect password. Please try again.');
      } else if (status === 403) {
        toast.error('Please verify your email before logging in. Check your inbox.');
      } else {
        toast.error(message || 'Login failed. Please try again.');
      }
    } finally {
      setIsLoading(false);
    }
  };

  // Register Handler
  const onSubmitRegister = async (data: RegisterCustomerData) => {
    try {
      setIsLoading(true);

      await registerCustomer(data);

      setRegisteredEmail(data.email);
      setRegistrationSuccess(true);
      toast.success('Registration successful! Please check your email.');
    } catch (error: any) {
      console.error('Registration error:', error);
      if (error.response?.status === 409) {
        toast.error('Email already registered. Please login instead.');
      } else {
        toast.error(error.response?.data?.message || 'Registration failed. Please try again.');
      }
    } finally {
      setIsLoading(false);
    }
  };

  // Registration Success State
  if (registrationSuccess) {
    return (
      <AuthLayout>
        <div className="text-center">
          <div className="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <CheckCircle className="w-10 h-10 text-green-600" />
          </div>

          <h2 className="text-2xl font-bold text-gray-800 mb-2">Registration Successful!</h2>

          <p className="text-gray-600 mb-6">
            We've sent a verification email to:
            <br />
            <span className="font-semibold text-gray-800">{registeredEmail}</span>
          </p>

          <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6 text-left">
            <p className="text-sm text-blue-800">
              <strong>Next steps:</strong>
            </p>
            <ul className="text-sm text-blue-700 mt-2 space-y-1 list-disc list-inside">
              <li>Check your email inbox</li>
              <li>Click the verification link</li>
              <li>Login to your account</li>
            </ul>
          </div>

          <Button
            variant="primary"
            size="medium"
            fullWidth
            onClick={() => {
              setRegistrationSuccess(false);
              setActiveTab('signin');
            }}
          >
            Go to Login
          </Button>
        </div>
      </AuthLayout>
    );
  }

  return (
    <AuthLayout>
      {/* TAB NAVIGATION */}
      <div className="flex border-b border-gray-200 mb-6">
        <button
          type="button"
          className={`flex-1 py-3 text-center font-semibold transition-colors ${
            activeTab === 'signin'
              ? 'text-primary border-b-2 border-primary'
              : 'text-gray-500 hover:text-gray-700'
          }`}
          onClick={() => setActiveTab('signin')}
        >
          Sign In
        </button>
        <button
          type="button"
          className={`flex-1 py-3 text-center font-semibold transition-colors ${
            activeTab === 'register'
              ? 'text-primary border-b-2 border-primary'
              : 'text-gray-500 hover:text-gray-700'
          }`}
          onClick={() => setActiveTab('register')}
        >
          Register
        </button>
      </div>

      {/* SIGN IN TAB */}
      {activeTab === 'signin' && (
        <>
          <h2 className="text-2xl font-bold text-gray-800 mb-2 text-center">Welcome Back</h2>
          <p className="text-gray-600 text-sm text-center mb-6">Sign in to continue to Replate</p>

          <form onSubmit={handleSubmitSignIn(onSubmitSignIn)} className="space-y-4">
            <Input
              label="Email"
              type="email"
              placeholder="example@gmail.com"
              leftIcon={<Mail size={20} />}
              error={errorsSignIn.email?.message}
              {...registerSignIn('email', {
                required: 'Email is required',
                pattern: {
                  value: /^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,
                  message: 'Invalid email address'
                }
              })}
            />

            <Input
              label="Password"
              isPassword
              placeholder="8 Characters minimum"
              leftIcon={<Lock size={20} />}
              error={errorsSignIn.password?.message}
              {...registerSignIn('password', {
                required: 'Password is required',
                minLength: {
                  value: 8,
                  message: 'Password must be at least 8 characters'
                }
              })}
            />

            <div className="text-right">
              <Link
                to="/forgot-password"
                className="text-sm text-primary hover:text-primary-dark font-medium"
              >
                Forget Password?
              </Link>
            </div>

            <Button type="submit" variant="primary" size="medium" fullWidth isLoading={isLoading}>
              {isLoading ? 'Signing in...' : 'Sign In'}
            </Button>

            <div className="relative my-6">
              <div className="absolute inset-0 flex items-center">
                <div className="w-full border-t border-gray-300"></div>
              </div>
              <div className="relative flex justify-center text-sm">
                <span className="px-2 bg-white text-gray-500">or</span>
              </div>
            </div>

            <Button variant="outline" size="medium" fullWidth disabled>
              <svg className="w-5 h-5 mr-2" viewBox="0 0 24 24">
                <path
                  fill="currentColor"
                  d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"
                />
                <path
                  fill="currentColor"
                  d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"
                />
                <path
                  fill="currentColor"
                  d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"
                />
                <path
                  fill="currentColor"
                  d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"
                />
              </svg>
              Google
            </Button>

            <div className="mt-6 text-center">
              <p className="text-sm text-gray-600">
                Register as a Merchant{' '}
                <Link
                  to="/register/merchant"
                  className="text-primary hover:text-primary-dark font-semibold"
                >
                  Register
                </Link>
              </p>
            </div>
          </form>
        </>
      )}

      {/* REGISTER TAB */}
      {activeTab === 'register' && (
        <>
          <h2 className="text-2xl font-bold text-gray-800 mb-2 text-center">Create Account</h2>
          <p className="text-gray-600 text-sm text-center mb-6">
            Join Replate and start saving food today!
          </p>

          <form onSubmit={handleSubmitRegister(onSubmitRegister)} className="space-y-4">
            {/* Full Name */}
            <Input
              label="Full Name"
              type="text"
              placeholder="Enter your full name"
              leftIcon={<User size={20} />}
              error={errorsRegister.name?.message}
              {...registerForm('name', {
                required: 'Name is required',
                minLength: {
                  value: 3,
                  message: 'Name must be at least 3 characters'
                }
              })}
            />

            {/* Email */}
            <Input
              label="Email Address"
              type="email"
              placeholder="Enter your email"
              leftIcon={<Mail size={20} />}
              error={errorsRegister.email?.message}
              {...registerForm('email', {
                required: 'Email is required',
                pattern: {
                  value: /^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,
                  message: 'Invalid email address'
                }
              })}
            />

            {/* Phone */}
            <Input
              label="Phone Number"
              type="tel"
              placeholder="08xxxxxxxxxx"
              leftIcon={<Phone size={20} />}
              error={errorsRegister.phone?.message}
              {...registerForm('phone', {
                required: 'Phone number is required',
                pattern: {
                  value: /^[0-9]{10,13}$/,
                  message: 'Invalid phone number (10-13 digits)'
                }
              })}
            />

            {/* Password */}
            <Input
              label="Password"
              isPassword
              placeholder="Create a password"
              leftIcon={<Lock size={20} />}
              error={errorsRegister.password?.message}
              helperText="Min. 8 characters with uppercase, lowercase & number"
              {...registerForm('password', {
                required: 'Password is required',
                minLength: {
                  value: 8,
                  message: 'Password must be at least 8 characters'
                },
                pattern: {
                  value: /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/,
                  message: 'Must contain uppercase, lowercase & number'
                }
              })}
            />

            {/* Confirm Password */}
            <Input
              label="Confirm Password"
              isPassword
              placeholder="Confirm your password"
              leftIcon={<Lock size={20} />}
              error={errorsRegister.confirmPassword?.message}
              {...registerForm('confirmPassword', {
                required: 'Please confirm your password',
                validate: (value) => value === password || 'Passwords do not match'
              })}
            />

            {/* Terms & Conditions */}
            {/* <div className="flex items-start gap-2">
              <input
                type="checkbox"
                id="terms"
                className="mt-1"
                {...registerForm('terms' as any, {
                  required: 'You must accept the terms and conditions'
                })}
              />
              <label htmlFor="terms" className="text-sm text-gray-600">
                I agree to the{' '}
                <a href="#" className="text-primary hover:text-primary-dark font-semibold">
                  Terms and Conditions
                </a>{' '}
                and{' '}
                <a href="#" className="text-primary hover:text-primary-dark font-semibold">
                  Privacy Policy
                </a>
              </label>
            </div>
            {errorsRegister.terms && (
              <p className="text-sm text-red-500 -mt-2">{(errorsRegister.terms as any).message}</p>
            )} */}

            {/* Register Button */}
            <Button type="submit" variant="primary" size="medium" fullWidth isLoading={isLoading}>
              {isLoading ? 'Creating Account...' : 'Create Account'}
            </Button>

            {/* Divider */}
            <div className="relative my-6">
              <div className="absolute inset-0 flex items-center">
                <div className="w-full border-t border-gray-300"></div>
              </div>
              <div className="relative flex justify-center text-sm">
                <span className="px-2 bg-white text-gray-500">or</span>
              </div>
            </div>

            {/* Social Register */}
            <Button variant="outline" size="medium" fullWidth disabled>
              Google
            </Button>

            {/* Links */}
            <p className="text-center text-sm text-gray-600 mt-4">
              Already have an account?{' '}
              <button
                type="button"
                onClick={() => setActiveTab('signin')}
                className="text-primary hover:text-primary-dark font-semibold"
              >
                Sign In
              </button>
            </p>

            <p className="text-center text-sm text-gray-600">
              Want to sell your products?{' '}
              <Link
                to="/register/merchant"
                className="text-primary hover:text-primary-dark font-semibold"
              >
                Register as Merchant
              </Link>
            </p>
          </form>
        </>
      )}
    </AuthLayout>
  );
}
</file>

<file path="frontend/src/pages/MerchantDashboard.tsx">
export default function MerchantDashboard() {
    return (
      <div className="min-h-screen bg-gray-50">
        <div className="max-w-7xl mx-auto px-4 py-8">
          <h1 className="text-3xl font-bold text-gray-800 mb-2">Merchant Dashboard</h1>
          <p className="text-gray-600">Placeholder - Will be built in Phase 2.8.4</p>
          <div className="mt-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
            <p className="text-sm text-yellow-800">
              ✅ Protected Route - Only accessible by merchants (role: 'merchant')
            </p>
            <p className="text-sm text-yellow-800 mt-1">
              ⚠️ Requires approval_status = 'approved'
            </p>
          </div>
        </div>
      </div>
    );
  }
</file>

<file path="frontend/src/pages/MerchantPendingApprovalPage.tsx">
export default function MerchantPendingApprovalPage() {
    return (
      <div className="min-h-screen bg-gray-50">
        <div className="max-w-2xl mx-auto px-4 py-8">
          <div className="bg-white rounded-lg shadow-lg p-8 text-center">
            <div className="text-6xl mb-4">⏳</div>
            <h1 className="text-3xl font-bold text-gray-800 mb-2">Pending Approval</h1>
            <p className="text-gray-600 mb-4">Placeholder - Will be built in Phase 2.7.1</p>
            <div className="mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
              <p className="text-sm text-yellow-800">
                ✅ Protected Route - Only accessible by merchants
              </p>
              <p className="text-sm text-yellow-800 mt-1">
                📌 Shown when approval_status = 'pending'
              </p>
            </div>
          </div>
        </div>
      </div>
    );
  }
</file>

<file path="frontend/src/pages/MerchantRejectedPage.tsx">
export default function MerchantRejectedPage() {
    return (
      <div className="min-h-screen bg-gray-50">
        <div className="max-w-2xl mx-auto px-4 py-8">
          <div className="bg-white rounded-lg shadow-lg p-8 text-center">
            <div className="text-6xl mb-4">❌</div>
            <h1 className="text-3xl font-bold text-gray-800 mb-2">Application Rejected</h1>
            <p className="text-gray-600 mb-4">Placeholder - Will be built in Phase 2.7.2</p>
            <div className="mt-6 p-4 bg-red-50 border border-red-200 rounded-lg">
              <p className="text-sm text-red-800">
                ✅ Protected Route - Only accessible by merchants
              </p>
              <p className="text-sm text-red-800 mt-1">
                📌 Shown when approval_status = 'rejected'
              </p>
            </div>
          </div>
        </div>
      </div>
    );
  }
</file>

<file path="frontend/src/pages/MyRatingsPage.tsx">
export default function MyRatingsPage() {
    return (
      <div className="min-h-screen bg-gray-50">
        <div className="max-w-7xl mx-auto px-4 py-8">
          <h1 className="text-3xl font-bold text-gray-800 mb-2">My Ratings Page</h1>
          <p className="text-gray-600">Placeholder - Will be built in Phase 4.1.6</p>
          <div className="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
            <p className="text-sm text-blue-800">
              ✅ Protected Route - Only accessible by customers
            </p>
          </div>
        </div>
      </div>
    );
  }
</file>

<file path="frontend/src/pages/RegisterMerchantPage.tsx">
export default function RegisterMerchantPage() {
    return (
      <div className="min-h-screen flex items-center justify-center bg-gray-50">
        <div className="text-center">
          <h1 className="text-3xl font-bold text-gray-800 mb-2">Register Merchant Page</h1>
          <p className="text-gray-600">Placeholder - Will be built in Phase 2.6</p>
          <p className="text-sm text-gray-500 mt-2">3-Step Registration</p>
        </div>
      </div>
    );
  }
</file>

<file path="frontend/src/pages/ResetPasswordPage.tsx">
import { useState, useEffect } from 'react';
import { useNavigate, useSearchParams, Link } from 'react-router-dom';
import { useForm } from 'react-hook-form';
import { Lock, CheckCircle } from 'lucide-react';
import toast from 'react-hot-toast';
import { resetPassword } from '../services/api';
import AuthLayout from '../components/layout/AuthLayout';
import Input from '../components/ui/Input';
import Button from '../components/ui/Button';

interface ResetPasswordFormData {
  newPassword: string;
  confirmPassword: string;
}

export default function ResetPasswordPage() {
  const navigate = useNavigate();
  const [searchParams] = useSearchParams();
  const [isLoading, setIsLoading] = useState(false);
  const [success, setSuccess] = useState(false);
  const [countdown, setCountdown] = useState(3);

  const token = searchParams.get('token');

  const {
    register,
    handleSubmit,
    watch,
    formState: { errors }
  } = useForm<ResetPasswordFormData>();

  const newPassword = watch('newPassword');

  // Redirect countdown after success
  useEffect(() => {
    if (success && countdown > 0) {
      const timer = setTimeout(() => {
        setCountdown(countdown - 1);
      }, 1000);
      return () => clearTimeout(timer);
    }

    if (success && countdown === 0) {
      navigate('/login');
    }
  }, [success, countdown, navigate]);

  const onSubmit = async (data: ResetPasswordFormData) => {
    if (!token) {
      toast.error('Invalid or missing reset token');
      return;
    }

    try {
      setIsLoading(true);

      // Call reset password API
      await resetPassword({
        token,
        newPassword: data.newPassword,
        confirmPassword: data.confirmPassword
      });

      // Success
      setSuccess(true);
      toast.success('Password reset successful!');
    } catch (error: any) {
      console.error('Reset password error:', error);
      if (error.response?.status === 400 && error.response?.data?.message?.includes('expired')) {
        toast.error('Reset link has expired. Please request a new one.');
      } else if (error.response?.status === 400 && error.response?.data?.message?.includes('invalid')) {
        toast.error('Invalid reset link. Please request a new one.');
      } else {
        toast.error(error.response?.data?.message || 'Failed to reset password. Please try again.');
      }
    } finally {
      setIsLoading(false);
    }
  };

  // Check if token exists
  if (!token) {
    return (
      <AuthLayout>
        <div className="text-center">
          <div className="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <span className="text-4xl">❌</span>
          </div>
          <h2 className="text-2xl font-bold text-gray-800 mb-2">Invalid Link</h2>
          <p className="text-gray-600 mb-6">
            This password reset link is invalid or has expired.
          </p>
          <Link to="/forgot-password">
            <Button variant="primary" size="medium" fullWidth>
              Request New Link
            </Button>
          </Link>
        </div>
      </AuthLayout>
    );
  }

  // Success state
  if (success) {
    return (
      <AuthLayout>
        <div className="text-center">
          {/* Success Icon */}
          <div className="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <CheckCircle className="w-10 h-10 text-green-600" />
          </div>

          {/* Title */}
          <h2 className="text-2xl font-bold text-gray-800 mb-2">Password Reset Successful!</h2>

          {/* Message */}
          <p className="text-gray-600 mb-6">
            Your password has been successfully reset.
            <br />
            Redirecting to login in <span className="font-bold text-primary">{countdown}</span> seconds...
          </p>

          {/* Manual redirect button */}
          <Link to="/login">
            <Button variant="primary" size="medium" fullWidth>
              Go to Login Now
            </Button>
          </Link>
        </div>
      </AuthLayout>
    );
  }

  // Form state
  return (
    <AuthLayout title="Reset Password" subtitle="Enter your new password">
      <form onSubmit={handleSubmit(onSubmit)} className="space-y-4">
        {/* New Password Input */}
        <Input
          label="New Password"
          isPassword
          placeholder="Enter new password"
          leftIcon={<Lock size={20} />}
          error={errors.newPassword?.message}
          helperText="Must be at least 8 characters"
          {...register('newPassword', {
            required: 'Password is required',
            minLength: {
              value: 8,
              message: 'Password must be at least 8 characters'
            },
            pattern: {
              value: /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/,
              message: 'Password must contain uppercase, lowercase, and number'
            }
          })}
        />

        {/* Confirm Password Input */}
        <Input
          label="Confirm Password"
          isPassword
          placeholder="Confirm new password"
          leftIcon={<Lock size={20} />}
          error={errors.confirmPassword?.message}
          {...register('confirmPassword', {
            required: 'Please confirm your password',
            validate: (value) =>
              value === newPassword || 'Passwords do not match'
          })}
        />

        {/* Submit Button */}
        <Button
          type="submit"
          variant="primary"
          size="medium"
          fullWidth
          isLoading={isLoading}
        >
          {isLoading ? 'Resetting...' : 'Reset Password'}
        </Button>

        {/* Back to Login */}
        <div className="text-center">
          <Link to="/login" className="text-sm text-gray-600 hover:text-gray-800">
            Back to Login
          </Link>
        </div>
      </form>
    </AuthLayout>
  );
}
</file>

<file path="frontend/src/pages/StoreReviewsPage.tsx">
export default function StoreReviewsPage() {
    return (
      <div className="min-h-screen bg-gray-50">
        <div className="max-w-7xl mx-auto px-4 py-8">
          <h1 className="text-3xl font-bold text-gray-800 mb-2">Store Reviews Page</h1>
          <p className="text-gray-600">Placeholder - Will be built in Phase 4.1.7</p>
          <div className="mt-4 p-4 bg-green-50 border border-green-200 rounded-lg">
            <p className="text-sm text-green-800">
              ✅ Public Route - Anyone can view store reviews
            </p>
          </div>
        </div>
      </div>
    );
  }
</file>

<file path="frontend/src/pages/VerifyEmailPage.tsx">
import { useState, useEffect } from 'react';
import { useNavigate, useSearchParams, Link } from 'react-router-dom';
import { CheckCircle, XCircle, Loader2, Mail } from 'lucide-react';
import toast from 'react-hot-toast';
import { verifyEmail, resendVerification } from '../services/api';
import AuthLayout from '../components/layout/AuthLayout';
import Button from '../components/ui/Button';

type VerificationState = 'loading' | 'success' | 'error' | 'already-verified';

export default function VerifyEmailPage() {
  const navigate = useNavigate();
  const [searchParams] = useSearchParams();
  const [state, setState] = useState<VerificationState>('loading');
  const [countdown, setCountdown] = useState(3);
  const [errorMessage, setErrorMessage] = useState('');
  const [isResending, setIsResending] = useState(false);

  const token = searchParams.get('token');

  // Auto-verify on mount
  useEffect(() => {
    if (!token) {
      setState('error');
      setErrorMessage('Verification token is missing');
      return;
    }

    const verify = async () => {
      try {
        await verifyEmail(token);
        setState('success');
        toast.success('Email verified successfully!');
      } catch (error: any) {
        console.error('Verification error:', error);
        const message = error.response?.data?.message || 'Verification failed';

        if (message.includes('already verified')) {
          setState('already-verified');
          setErrorMessage('This email has already been verified');
        } else if (message.includes('expired')) {
          setState('error');
          setErrorMessage('Verification link has expired');
        } else if (message.includes('invalid')) {
          setState('error');
          setErrorMessage('Invalid verification link');
        } else {
          setState('error');
          setErrorMessage(message);
        }
      }
    };

    verify();
  }, [token]);

  // Redirect countdown after success
  useEffect(() => {
    if (state === 'success' && countdown > 0) {
      const timer = setTimeout(() => {
        setCountdown(countdown - 1);
      }, 1000);
      return () => clearTimeout(timer);
    }

    if (state === 'success' && countdown === 0) {
      navigate('/login');
    }
  }, [state, countdown, navigate]);

  // Resend verification
  const handleResend = async () => {
    const email = prompt('Please enter your email address:');
    if (!email) return;

    try {
      setIsResending(true);
      await resendVerification(email);
      toast.success('Verification email sent! Please check your inbox.');
    } catch (error: any) {
      toast.error(error.response?.data?.message || 'Failed to resend verification email');
    } finally {
      setIsResending(false);
    }
  };

  // Loading state
  if (state === 'loading') {
    return (
      <AuthLayout>
        <div className="text-center">
          <Loader2 className="w-16 h-16 text-primary animate-spin mx-auto mb-4" />
          <h2 className="text-2xl font-bold text-gray-800 mb-2">Verifying Your Email</h2>
          <p className="text-gray-600">Please wait while we verify your email address...</p>
        </div>
      </AuthLayout>
    );
  }

  // Success state
  if (state === 'success') {
    return (
      <AuthLayout>
        <div className="text-center">
          {/* Success Icon */}
          <div className="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <CheckCircle className="w-10 h-10 text-green-600" />
          </div>

          {/* Title */}
          <h2 className="text-2xl font-bold text-gray-800 mb-2">Email Verified!</h2>

          {/* Message */}
          <p className="text-gray-600 mb-6">
            Your email has been successfully verified.
            <br />
            Redirecting to login in <span className="font-bold text-primary">{countdown}</span>{' '}
            seconds...
          </p>

          {/* Login Button */}
          <Link to="/login">
            <Button variant="primary" size="medium" fullWidth>
              Go to Login Now
            </Button>
          </Link>
        </div>
      </AuthLayout>
    );
  }

  // Already Verified state
  if (state === 'already-verified') {
    return (
      <AuthLayout>
        <div className="text-center">
          {/* Info Icon */}
          <div className="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <Mail className="w-10 h-10 text-blue-600" />
          </div>

          {/* Title */}
          <h2 className="text-2xl font-bold text-gray-800 mb-2">Already Verified</h2>

          {/* Message */}
          <p className="text-gray-600 mb-6">
            This email address has already been verified.
            <br />
            You can now login to your account.
          </p>

          {/* Login Button */}
          <Link to="/login">
            <Button variant="primary" size="medium" fullWidth>
              Go to Login
            </Button>
          </Link>
        </div>
      </AuthLayout>
    );
  }

  // Error state
  return (
    <AuthLayout>
      <div className="text-center">
        {/* Error Icon */}
        <div className="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
          <XCircle className="w-10 h-10 text-red-600" />
        </div>

        {/* Title */}
        <h2 className="text-2xl font-bold text-gray-800 mb-2">Verification Failed</h2>

        {/* Error Message */}
        <p className="text-gray-600 mb-6">{errorMessage}</p>

        {/* Actions */}
        <div className="space-y-3">
          <Button
            className='mb-2;'
            variant="primary"
            size="medium"
            fullWidth
            onClick={handleResend}
            isLoading={isResending}
          >
            {isResending ? 'Sending...' : 'Resend Verification Email'}
          </Button>

          <Link to="/login">
            <Button className='mt-2'variant="outline" size="medium" fullWidth>
              Back to Login
            </Button>
          </Link>
        </div>
      </div>
    </AuthLayout>
  );
}
</file>

<file path="frontend/tailwind.config.js">
/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./index.html",
    "./src/**/*.{js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {
      colors: {
        primary: {
          DEFAULT: '#2D9D78',
          light: '#3DB88C',
          dark: '#257A5E',
        },
        secondary: {
          DEFAULT: '#1F7A5C',
        },
      },
      fontFamily: {
        sans: ['Inter', 'system-ui', 'sans-serif'],
      },
      backgroundImage: {
        'gradient-green': 'linear-gradient(135deg, #2D9D78 0%, #1F7A5C 100%)',
      },
    },
  },
  plugins: [],
}
</file>

<file path="frontend/tsconfig.json">
{
  "files": [],
  "references": [
    { "path": "./tsconfig.app.json" },
    { "path": "./tsconfig.node.json" }
  ]
}
</file>

<file path="frontend/tsconfig.node.json">
{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.node.tsbuildinfo",
    "target": "ES2023",
    "lib": ["ES2023"],
    "module": "ESNext",
    "types": ["node"],
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "verbatimModuleSyntax": true,
    "moduleDetection": "force",
    "noEmit": true,

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["vite.config.ts"]
}
</file>

<file path="frontend/vite.config.ts">
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

// https://vite.dev/config/
export default defineConfig({
  plugins: [react()],
})
</file>

<file path="backend/.gitignore">
.env
/node_modules
# Claude Code temporary files
tmpclaude-*
</file>

<file path="backend/src/config/db.js">
const {Pool} = require('pg')
require('dotenv').config();

const pool = new Pool({
    connectionString: process.env.DATABASE_URL,
});

pool.on('connect', () => {
    console.log('Connected to the database');
})

pool.on('error', (err) =>{
    console.error('Unexpected database error:', err);
    process.exit(-1);
});

module.exports = pool;
</file>

<file path="backend/src/middleware/authMiddleware.js">
const jwt = require('jsonwebtoken');

// Middleware to authenticate JWT tokens
const verifyToken = (req, res, next) => {
    const authHeader = req.headers.authorization;
    const token = authHeader && authHeader.split(' ')[1];

    if (!token) {
        return res.status(401).json({
            success: false,
            message: 'Access denied. No token provided.'
        });
    }

        try{
            const decoded = jwt.verify(token, process.env.JWT_SECRET);
            req.user = decoded;
            next();
        } catch (error){
            if (error.name === 'TokenExpiredError') {
                return res.status(401).json({
                    success: false,
                    message: 'Token has expired. Please Relogin'
                });
            }
            return res.status(401).json({
                success: false,
                message: 'Invalid token.'
            })
        }
};

//Middleware to verify roles
const checkRole = (...allowedRoles) =>{
    return (req,res, next) => {
        if(!allowedRoles.includes(req.user.role)){
            return res.status(403).json({
                success: false,
                message: 'Access forbidden. You do not have the required role.'
            });
        }
        next();
    };
};

module.exports = {verifyToken, checkRole};
</file>

<file path="backend/src/utils/emailservice.js">
const nodemailer = require('nodemailer');

//configure email transporter
const transporter = nodemailer.createTransport({
    service: 'gmail',
    auth:{
        user:process.env.EMAIL_USER,
        pass: process.env.EMAIL_PASS
    },
});

//Send verification email 
const sendVerificationEmail = async (email, name, verificationToken, userType = 'user') => {
    const verificationUrl= `${process.env.FRONTEND_URL}/verify-email?token=${verificationToken}`;

    //Different message based on user type
    const roleMessage = userType ==='merchant'
    ? 'Welcome to Replate as a <strong>Bakery Owner</strong>!' 
    : 'Welcome to Replate!';

    const mailOptions = {
        from: `"Replate - Bakery Marketplace" <${process.env.EMAIL_USER}`,
        to: email,
        subject: 'Verify Your Email - Replate',
        html: `
            <div style = "font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px;">
                <div style= "text-align: center; margin-bottom: 30px;">
                    <h1 style ="color: #2D7A5E; margin: 0;">Replate</h1>
                    <p style ="color: #666; margin: 5px 0;">Rescue. Reduce. Replate</p>
                </div>

                <h2 style="color: #2D7A5E;">${roleMessage}</h2>

                <p style="color: #333; line-height: 1.6;"> Hello <strong>${name}</strong>,</p> 

                <p style= "color: #333; line-height: 1.6;">
                    Thank you for registering at Replate! To complete your registration and activate your account, 
                    please verify your email address by clicking the link below:
                </p>
                
                <div style="text-align :center; margin: 30px 0;">
                    <a href="${verificationUrl}"
                        style="display: inline-block; padding: 14px 28px; background-color: #2D7A5E; color: white; text-decoration: none; border-radius: 8px; font-weight: bold; font-size: 16px;">
                        Verify Email Address
                    </a>
                </div>
                <p style= "color: #666; line-height: 1.6; font-size: 14px;>
                    Or copy and paste this link in your browser:
                </p>
                <div style = "margin-top: 40px; padding-top: 20px; border-top 1px solid #ddd;">
                    <p style= "color: #999; font-size: 12px; line-height: 1.6;">
                        This verification link will expire in <strong> 1 hours</strong>.
                    </p>
                    <p style= "color: #999; font-size: 12px; line-height: 1.6;">
                        If you don't create an account with Replate, please ignore this email.
                    </p>
                </div>

                <div style="text-align: center; margin-top: 30px; color: #999; font-size: 12px">
                    <p>&copy; 2026 Replate. All rights reserved.</p>
                </div>
            </div>
            `
    };

    try {
        await transporter.sendMail(mailOptions);
        console.log(`Verification email sent to: ${email} (${userType})`);
        return true;
    } catch (error) {
        console.error('Error sending verification email: ', error.message);
        return false;
    };
};

//resend Verfification Email
const resendVerificationEmail = async (email, name, verificationToken, userType = 'user') => {
    return await sendVerificationEmail(email, name, verificationToken, userType);
};

//Send forget password reset email
const sendPasswordResetEmail = async (email, name, resetToken) =>{
    const resetUrl = `${process.env.FRONTEND_URL}/reset-password?token=${resetToken}`;

    const mailOptions = {
        from: `"Replate - Bakery MarketPlace" <${process.env.EMAIL_USER}>`,
        to: email,
        subject: 'Reset Your Password - Replate',
        html:`
            <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px;">
                <div style="text-align: center; margin-bottom: 30px;">
                    <h1 style= "color: #2D7A5E; margin: 0;">
                        Replate
                    </h1>
                    <p style = "color: #666; margin: 5px 0;">
                        Rescue. Reduce. Replate
                    </p>
                </div>

                <h2 style= "color: #2D7A5E;">
                    Password Reset Request
                </h2>
                <p style="color: #333; line-height: 1.6;">
                    Hello <strong>${name}</strong>,</p>
                
                 <p style="color: #333; line-height: 1.6;">
                    We received a request to reset your password. Click the button below to create a new password:
                </p>
                
                <div style="text-align: center; margin: 30px 0;">
                    <a href="${resetUrl}" 
                       style="display: inline-block; padding: 14px 28px; background-color: #2D7A5E; color: white; text-decoration: none; border-radius: 8px; font-weight: bold; font-size: 16px;">
                        Reset Password
                    </a>
                </div>
                
                <p style="color: #666; line-height: 1.6; font-size: 14px;">
                    Or copy and paste this link in your browser:
                </p>
                <p style="color: #2D7A5E; word-break: break-all; background-color: #f5f5f5; padding: 10px; border-radius: 5px; font-size: 12px;">
                    ${resetUrl}
                </p>
                
                <div style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #ddd;">
                    <p style="color: #999; font-size: 12px; line-height: 1.6;">
                        ⏰ This link will expire in <strong>1 hour</strong>.
                    </p>
                    <p style="color: #999; font-size: 12px; line-height: 1.6;">
                        If you didn't request a password reset, please ignore this email or contact support if you have concerns.
                    </p>
                </div>
                
                <div style="text-align: center; margin-top: 30px; color: #999; font-size: 12px;">
                    <p>© 2025 Replate. All rights reserved.</p>
                </div>
            </div>   
        `
    };
    try {
        await transporter.sendMail(mailOptions);
        console.log(`Password reset email sen to:${email}`);
        return true;
    } catch (error) {
        console.error('Error sending password reset email:', error.message);
        return false;
    }
};


module.exports = {
    sendVerificationEmail,
    resendVerificationEmail,
    sendPasswordResetEmail
};
</file>

<file path="backend/src/utils/validation.js">
//Email Validation
const isValidEmail = (email) => {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
};

// Password Validation
const isValidPassword = (password) => {
    return password && password.length >= 8;
};

//Phone Number Validation(ID)
const isValidPhoneNumber = (phone) => {
    const phoneRegex = /^(\+62|62|0)[0-9]{9,12}$/;
    return !phone|| phoneRegex.test(phone)
};

const isPasswordMatch = (password, confirmPassword) => {
    return password === confirmPassword;
};

module.exports = {
    isValidEmail,
    isValidPassword,
    isValidPhoneNumber,
    isPasswordMatch
};
</file>

<file path="frontend/package.json">
{
  "name": "frontend",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc -b && vite build",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "@icons-pack/react-simple-icons": "^13.8.0",
    "@types/leaflet": "^1.9.21",
    "axios": "^1.13.2",
    "leaflet": "^1.9.4",
    "lucide-react": "^0.562.0",
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    "react-hook-form": "^7.71.1",
    "react-hot-toast": "^2.6.0",
    "react-leaflet": "^5.0.0",
    "react-router-dom": "^7.12.0"
  },
  "devDependencies": {
    "@eslint/js": "^9.39.1",
    "@types/node": "^24.10.1",
    "@types/react": "^19.2.5",
    "@types/react-dom": "^19.2.3",
    "@vitejs/plugin-react": "^5.1.1",
    "autoprefixer": "^10.4.23",
    "eslint": "^9.39.1",
    "eslint-plugin-react-hooks": "^7.0.1",
    "eslint-plugin-react-refresh": "^0.4.24",
    "globals": "^16.5.0",
    "postcss": "^8.5.6",
    "tailwindcss": "^3.4.19",
    "typescript": "~5.9.3",
    "typescript-eslint": "^8.46.4",
    "vite": "^7.2.4"
  }
}
</file>

<file path="frontend/src/@types/index.ts">
//User types
export interface User {
    user_id: string;
    email: string;
    name: string;
    role: 'user' | 'merchant' | 'admin';
    is_verified: boolean;
    created_at: string;
    updated_at?: string;
}

export interface LoginCredentials {
    email: string;
    password: string;
}

export interface RegisterCustomerData {
    name: string;
    email: string;
    phone: string;
    password: string;
    confirmPassword: string;
}

export interface RegisterMerchantStep1Data{
    name: string;
    email: string;
    phone: string;
    password: string
    confirmPassword: string;
}

export interface RegisterMerchantStep2Data{
    storeName: string;
    description: string;
    address: string;
    city: string;
    latitude: number;
    longitude: number;
    phone: string;
    operatingHours: string;
}

export interface RegisterMerchantStep3Data{
    bankAccountNumber: string;
    qrisImage?: File;
    idCardImage?: File;
}

export interface ForgotPasswordData{
    email: string;
}

export interface ResetPasswordData{
    token: string;
    newPassword: string;
    confirmPassword: string;
}


//API Response Types
export interface ApiResponse<T = any> {
    success: boolean;
    message: string;
    data?: T;
}

export interface AuthResponse {
    user: User;
    token: string;
    emailSent?: boolean;
}

//Store types
export interface Store{
    store_id: string;
    merchant_id: string;
    store_name: string;
    description?: string;
    address: string;
    city: string;
    latitude: number;
    longitude: number;
    phone: string;
    operating_hours: string;
    logo_url?: string;
    banner_url?: string;
    bank_account_number?: string;
    qris_image_url?: string;
    id_card_image_url?: string;
    is_active: boolean;
    approval_status: 'pending' | 'approved' | 'rejected';
    admin_notes?: string;
    approved_at?: string;
    approved_by?: string;
    created_at: string;
    updated_at?: string;
}

//Map types
export interface LatLng{
    lat: number;
    lng: number;
}

//tab types
export type AuthTab = 'signin' | 'register';
</file>

<file path="frontend/src/index.css">
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
@import 'leaflet/dist/leaflet.css';

@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  body {
    @apply font-sans antialiased bg-gray-50;
  }
}

@layer components {
  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
}
</file>

<file path="frontend/tsconfig.app.json">
{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.app.tsbuildinfo",
    "incremental": true,
    "target": "ES2022",
    "useDefineForClassFields": true,
    "lib": ["ES2022", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "types": ["vite/client"],
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "verbatimModuleSyntax": true,
    "moduleDetection": "force",
    "noEmit": true,
    "jsx": "react-jsx",

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    // "noUncheckedSideEffectImports": true
  },
  "include": ["src"]
}
</file>

<file path="backend/package.json">
{
  "name": "backend",
  "version": "1.0.0",
  "main": "server.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1",
    "start": "node src/server.js",
    "dev": "nodemon src/server.js"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "description": "",
  "dependencies": {
    "bcryptjs": "^3.0.3",
    "cors": "^2.8.5",
    "dotenv": "^17.2.3",
    "express": "^5.2.1",
    "jsonwebtoken": "^9.0.3",
    "nodemailer": "^7.0.12",
    "pg": "^8.17.2"
  },
  "devDependencies": {
    "nodemon": "^3.1.11"
  }
}
</file>

<file path="backend/src/controllers/authController.js">
const bcrypt = require('bcryptjs');
const jwt = require('jsonwebtoken');
const pool = require('../config/db');
const {
    isValidEmail,
    isValidPassword,
    isValidPhoneNumber,
    isPasswordMatch
} = require('../utils/validation');
const {
    sendVerificationEmail,
    resendVerificationEmail,
    sendPasswordResetEmail
} = require('../utils/emailservice');

// User Registration
const registerUser = async (req, res) => {
    try{
        const { email, password, confirmPassword, name, phone} = req.body;

        //input validation
        if(!email || !password ||!confirmPassword || !name ||!phone){
            return res.status(400).json({
                success: false,
                message: 'All fields are required.'
            });
        }
        if(!isValidEmail(email)){
            return res.status(400).json({
                success: false,
                message: 'Invalid email format.'
            });
        }

        if(!isValidPassword(password)){
            return res.status(400).json({
                success: false,
                message: 'Password must be 8 characters or longer.'
            });
        }

        if(!isPasswordMatch(password, confirmPassword)){
            return res.status(400).json({
                success: false,
                message: 'Passwords do not match.'
            })
        }

        if(!isValidPhoneNumber(phone)){
            return res.status(400).json({
                success: false,
                message: 'Invalid Phone Number format.'
            });
        }

        //Check if email registered
        const userExists = await pool.query(
            'SELECT * FROM users WHERE email = $1', [email]
        );

        if(userExists.rows.length > 0){
            return res.status(400).json({
                success: false,
                message: 'Email is already registered.'
            });
        }

        //Hash Password
        const salt = await bcrypt.genSalt(10);
        const hashedPassword = await bcrypt.hash(password, salt);

        //Insert User
        const result = await pool.query(
            `INSERT INTO users (email, password, name, phone, role) VALUES ($1, $2, $3, $4, 'user') RETURNING user_id, email, name, phone, role, created_at`, [email, hashedPassword, name, phone]
        );

        const newUser = result.rows[0];

        //Generate JWT token
        const token = jwt.sign({
            userId: newUser.user_id,
            email: newUser.email,
            role: newUser.role
        },
        process.env.JWT_SECRET,
        {expiresIn: '7d'});

        //generate verification token
        const verificationToken = jwt.sign(
            {
                userId: newUser.user_id,
                email: newUser.email,
                purpose: 'email-verification'
            },
            process.env.JWT_SECRET,
                {expiresIn: '24h'}
        );

        //send verification email
        const emailSent = await sendVerificationEmail(
            newUser.email,
            newUser.name,
            verificationToken,
            'user'
        );

        res.status(201).json({
            success: true,
            message:emailSent 
            ? 'User registered Successfully! Please check your email to verify your account.'
            : 'User registered succesfully. Please verify your email to activate your account.',
            data: {
                user: newUser,
                token: token,
                emailSent: emailSent
            }
        });
    } catch (error){
        console.error('Register User Error:', error);
        res.status(500).json({
            success: false,
            message: 'Internal server error.'
        });
    }
};

// Merchant Register
const RegisterMerchant = async (req, res) => {
    try{
        const{email, password, confirmPassword, name, phone} = req.body;

        if(!email || !password || !confirmPassword || !name || !phone){
            return res.status(400).json({
                success: false,
                message: 'All fields are required.'
            });
        }

        if(!isValidEmail(email)){
            return res.status(409).json({
                success: false,
                message: 'Invalid email format.'
            });
        }

        if(!isValidPassword(password)){
            return res.status(400).json({
                success: false,
                message: 'Password must be 8 characters or longer.'
            });
        }

        if(!isPasswordMatch(password, confirmPassword)){
            return res.status(400).json({
                success: false,
                message: 'Passwords do not match.'
            });
        }

        if(!isValidPhoneNumber(phone)){
            return res.status(400).json({
                success: false,
                message: 'Invalid Phone Number format.'
            });
        }

        //Check if email registered
        const userExists = await pool.query(
            'SELECT * FROM users WHERE email = $1', [email]
        );

        if (userExists.rows.length > 0){
            return res.status(400).json({
                success: false,
                message: 'Email is already registered.'
            });
        }

        //Hash Password
        const salt = await bcrypt.genSalt(10);
        const hashedPassword = await bcrypt.hash(password, salt);

        //Insert Merchant User
        const result = await pool.query(
            `INSERT INTO users (email, password, name, phone, role) VALUES ($1, $2, $3, $4, 'merchant') RETURNING user_id, email, name, phone, role, created_at`, [email, hashedPassword, name, phone]
        );

        const newUser = result.rows[0];

        //Generate JWT token
        const token = jwt.sign({
            userId: newUser.user_id,
            email: newUser.email,
            role: newUser.role,
        },
         process.env.JWT_SECRET, {
            expiresIn: '7d'}
        );

        res.status(201).json({
            success: true,
            message: 'Store account created. Please complete store registration.',
            data:{
                user: newUser,
                token: token
            }
        });

    }catch (error){
        console.error('Register Store Account Error:', error);
        res.status(500).json({
            success: false,
            message: 'Interval server error.'
        });
    } 
};

// RegisterMerchantInfo
// page 2
const registerStoreInfo = async (req, res) => {
    try{
        const merchantID = req.user.userId;
        const {storeName, description, address, city, latitude, longitude, phone, operatingHours} = req.body;

        //validasi role
        if(req.user.role !== 'merchant'){
            return res.status(403).json({
                success: false,
                message: 'Not authorized, only store owner can register.'
            });
        }

        //Input validation
        if(!storeName || !description || !address || !city || !latitude || !longitude || !phone || !operatingHours) {
            return res.status(403).json({
                success: false,
                message: 'All fields are required.'
            });
        }

        //Check if merchant already registered store
        const storeExists = await pool.query(
            'SELECT * FROM stores WHERE merchant_id = $1',[merchantID]
        );

        if (storeExists.rows.length > 0){
            return res.status(400).json({
                success: false,
                message: 'You have a store registered.'
            });
        };

        //Insert Store Information
        const result = await pool.query(
            `INSERT INTO stores (merchant_id, store_name, description, address, city, latitude, longitude, phone, operating_hours, is_active) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, false) RETURNING *`, [merchantID, storeName, description, address, city, latitude, longitude, phone, operatingHours]
        );

        res.status(201).json({
            success: true, 
            message: 'Store info saved. Please complete Verification.',
            data:{
                store: result.rows[0]
            }
        });

    } catch (error){
        console.error('Register Store Info Error:', error);
        res.status(500).json({
            success: false,
            message: 'Internal Server Error.'
        });
    }
};

// Register Merchant Verfication
// Page 3

const registerStoreVerification = async (req, res) => {
    try {
        const merchantID = req.user.userId;
        const {bankAccountNumber} = req.body;

        if(!bankAccountNumber){
            return res.status(400).json({
                success: false,
                message: 'Bank account number is required.'
            });
        }


        const result = await pool.query(
            `UPDATE stores SET bank_account_number = $1
            WHERE merchant_id = $2
            RETURNING *`, [bankAccountNumber, merchantID]
        );

        if (result.rows.length === 0) {
            return res.status(404).json({
                success: false,
                message: 'Store not found.'
            });
        }

//Get merchant user info
        const userResult = await pool.query(
            'SELECT user_id, email, name, is_verified FROM users WHERE user_id = $1', [merchantID]
        );

        if (userResult.rows.length === 0) {
            return res.status(404).json({
                success: false,
                message: 'User not found.'
            });
        }

        const user = userResult.rows[0];

        //Send email verification
        let emailSent = false;
        let verificationToken = null;

        if (!user.is_verified) {
            verificationToken = jwt.sign(
                {
                    userId: user.user_id,
                    email: user.email,
                    purpose: 'email-verification'
                },
                process.env.JWT_SECRET,
                { expiresIn: '24h' }
            );

            emailSent = await sendVerificationEmail(
                user.email,
                user.name,
                verificationToken,
                'merchant'
            );
        }

        res.status(200).json({
            success: true,
            message: user.is_verified
                ? 'Store registration completed. Waiting for admin approval.'
                : 'Store registration completed! Please check your email to verify your account before admin review.',
            data: {
                store: result.rows[0],
                emailSent: emailSent,
                needsVerification: !user.is_verified,
            },
        });

    } catch (error) {
        console.error('Register Store Verfication Error:', error);
        res.status(500).json({
            success: false,
            message: 'Internal Server Error'
        });
    }
}

// Login
const login = async (req, res) => {
    try {
        const {email, password} = req.body;

        if (!email || !password) {
            return res.status(400).json({
                success: false,
                message:'Email and password are required'
            });
        }

        //Check if user exists
        const result = await pool.query(
            `SELECT * FROM users WHERE email = $1`, [email]
        );

        if (result.rows.length === 0){
            return res.status(401).json({
                success:false,
                message:'User not found, please register.'
            });
        }

        const user = result.rows[0];

        //verify password
        const isValidPassword = await bcrypt.compare(password, user.password);

        if (!isValidPassword) {
            return res.status(401).json({
                success: false,
                message: 'Invalid email or password.'
            });
        }

        // Generate JWT Token
        const token = jwt.sign({
            userId: user.user_id,
            email: user.email,
            role: user.role
        },
            process.env.JWT_SECRET,
            {expiresIn: '7d'}
        );   

        //Return user data withthout password
        const { password: _, ...userData} = user;

        res.status(200).json({
            success:true,
            message: 'Login successful.',
            data: {
                user: userData,
                token,
            }
        });  
    } catch (error) {
        console.error('Login error', error);
        return res.status(500).json({
            success: false,
            message: 'Internal server error.'
        });
    }
};

//Get profile
const getProfile = async (req,res) => {
    try {
        const userId =req.user.userId;
        const result = await pool.query(
            'SELECT user_id, email, name, phone, role, is_verified, created_at FROM users WHERE user_id = $1', [userId]
        );

        if (result.rows.length === 0){
            return res.status(404).json({
                success: false,
                message: 'User Not Found'
            });
        }

        res.status(200).json({
            success: true,
            data:{
                user: result.rows[0]
            },
        });
    } catch (error) {
        console.error('Get profile Error:', error);
        res.status(500).json({
            success: false,
            message: 'Internal server Error.'
        });
    }
};

//Verify Email
const verifyEmail = async (req, res) =>{
    try {
        const {token} = req.body;

        if(!token){
            return res.status(400).json({
                success:false,
                message: 'Verification token is required.'
            });
        }

        //verify token
        let decoded;
        try {
            decoded = jwt.verify(token, process.env.JWT_SECRET);
        } catch (error) {
            if (error.name === 'TokenExpiredError'){
                return res.status(400).json({
                    success: false,
                    message: 'Verification token has expired. Please request a new verification email.',
                    expired: true
                });
            }

            return res.status(400).json({
                success: false,
                message: 'Invalid verification token.'
            });
        }

        // Check if token is for email verification
        if(decoded.purpose !== 'email-verification'){
            return res.status(400).json({
                success: false,
                message: 'Invalid verification token.'
            });
        }

        //check if user exists
        const result = await pool.query(
            'SELECT user_id, email, name, role, is_verified FROM users WHERE user_id = $1', [decoded.userId]
        );

        if (result.rows.length === 0){
            return res.status(404).json({
                success: false,
                message: 'User not found.'
            });
        }

        const user = result.rows[0];

        if (user.is_verified){
            return res.status(400).json({
                success: false,
                message: 'Email is already verified.'
            });
        }

        //update user as verfied
        await pool.query(
            'UPDATE users SET is_verified = true, updated_at = CURRENT_TIMESTAMP WHERE user_id = $1', [decoded.userId]
        );

        res.status(200).json({
            success: true, 
            message: user.role === 'merchant'
                ? 'Email verified successfully! Your store registration will be reviewed by admin.'
                : 'Email verified successfully! You can now enjoy all features.',
            data:{
                user: {
                    email: user.email,
                    name: user.name,
                    role: user.role,
                    is_verified: true
                },
            },
        });
    } catch (error) {
        console.error('Verify Email Error:', error);
        res.status(500).json({
            success: false,
            message: 'Internal Server Error.'
        });
    }
};

//Resend verification Email
const resendVerification = async (req, res) => {
    try {
        const {email} = req.body;

        if(!email){
            return res.status(400).json({
                success: false,
                message: 'Email is required.'
            });
        }

        const result = await pool.query(
            'SELECT user_id, email, name, is_verified, role FROM users WHERE email = $1', [email]
        );

        if(result.rows.length === 0){
            return res.status(404).json({
                success: false,
                message: 'User not found.'
            });
        }

        const user = result.rows[0];

        //check if already verfied
        if(user.is_verified){
            return res.status(400).json({
                success: false,
                message: 'Email is already verified.'
            });
        }

        //generate new verification token
        const verificationToken = jwt.sign(
            {
                userId: user.user_id,
                email: user.email,
                purpose: 'email-verification'
            },
            process.env.JWT_SECRET,
            {expiresIn: '24h'}
        );

        //send email
        const userType = user.role ==='merchant' ? 'merchant' : 'user';
        const emailSent = await resendVerificationEmail(
            user.email,
            user.name,
            verificationToken,
            userType
        );

        if(!emailSent){
            return res.status(500).json({
                success: false,
                message: 'Failed to send verification email. Please try again later.'
            });
        }

        res.status(200).json({
            success: true,
            message: 'Verification email resent. Please check your email.'
        });
    } catch (error) {
        console.error('Resend Verification Error: '. error);
        res.status(500).json({
            success: false,
            message: 'Internal Server Error.'
        });

    }
};

const forgotPassword = async (req, res) =>{
    try {
        const {email} = req.body;

        if(!email){
            return res.status(400).json({
                success: false,
                message: 'Email is required.'
            });
        }

        //check if user exists
        const result = await pool.query(
            'SELECT user_id, email, name FROM users WHERE email = $1', [email]
        );

        if (result.rows.length === 0){
            return res.status(200).json({
                success: true,
                message: 'Email has not registered'
            });
        }

        const user = result.rows[0];

        //generate password reset token (expires in 1 hour)
        const resetToken = jwt.sign(
            {
                userId: user.user_id,
                email: user.email,
                purpose: 'password-reset'
            },
            process.env.JWT_SECRET,
            {expiresIn: '1h'}
        );

        //send password reset email
        const emailSent = await sendPasswordResetEmail(
            user.email,
            user.name,
            resetToken
        );

        if(!emailSent){
            return res.status(500).json({
                success: false,
                message: 'Failed to send password reset email. Please try again later.'
            });
        }

        res.status(200).json({
            success: true,
            message: 'Password reset email sent. Please check your email.'
        });

    } catch (error) {
        console.error('Forgot Password Error:', error);
        res.status(500).json({
            success: false,
            message: 'Internal Server Error.'
        });
    }
};

//Reset Password
const resetPassword = async (req, res) => {
    try {
        const {token, newPassword, confirmPassword} = req.body;

        if(!token || !newPassword || !confirmPassword){
            return res.status(400).json({
                success: false,
                message: 'All fields are required.'
            });
        }

        if(!isValidPassword(newPassword)){
            return res.status(400).json({
                success: false,
                message:'Password must be 8 characters or longer'
            });
        }

        if(!isPasswordMatch(newPassword, confirmPassword)){
            return res.status(400).json({
                success: false,
                message: 'Passwords do not match.'
            });
        }

        //verify token
        let decoded;
        try {
            decoded = jwt.verify(token, process.env.JWT_SECRET);
        } catch (error) {
            if(error.name === 'TokenExpiredError'){
                return res.status(400).json({
                    success: false,
                    message: 'Password reset link has expired. Please request a new one.',
                    expired: true
                });
            }
            return res.status(400).json({
                success: false,
                message: 'Invalid password reset link.'
            });
        }

        //Check if token is for password reset
        if (decoded.purpose !== 'password-reset'){
            return res.status(400).json({
                success: false,
                message: 'Invalid password reset link.'
            });
        }

        //Check if user exists
        const result = await pool.query(
            'SELECT user_id, email, name FROM users WHERE user_id = $1', [decoded.userId]
        );

        if (result.rows.length === 0){
            return res.status(404).json({
                success: false,
                message: 'User not found.'
            });
        }

        const user = result.rows[0];

        //Hash new password
        const salt = await bcrypt.genSalt(10);
        const hashedPassword = await bcrypt.hash(newPassword, salt);

        //Update user password
        await pool.query(
            'UPDATE users SET password = $1, updated_at = CURRENT_TIMESTAMP WHERE user_id = $2', [hashedPassword, decoded.userId]
        );

        res.status(200).json({
            success: true,
            message: 'Password has been reset successfully. You can now log in with your new password.',
            data: {
                email: user.email,
            }
        });
    } catch (error) {
        console.error('Reset Password Error:', error);
        res.status(500).json({
            success: false,
            message: 'Internal server error.'
        });
    }
};

module.exports = {
    registerUser,
    RegisterMerchant,
    registerStoreInfo,
    registerStoreVerification,
    login,
    getProfile,
    verifyEmail,
    resendVerification,
    forgotPassword,
    resetPassword
};
</file>

<file path="frontend/src/App.tsx">
import { BrowserRouter, Routes, Route, Navigate } from 'react-router-dom';
import { Toaster } from 'react-hot-toast';
import { AuthProvider } from './context/AuthContext';
import './index.css'

// ========================================
// PUBLIC PAGES (Auth)
// ========================================
import LoginPage from './pages/LoginPage';
import ForgotPasswordPage from './pages/ForgotPasswordPage';
import ResetPasswordPage from './pages/ResetPasswordPage';

import RegisterMerchantPage from './pages/RegisterMerchantPage';
import VerifyEmailPage from './pages/VerifyEmailPage';

// ========================================
// CUSTOMER PAGES
// ========================================
import CustomerDashboard from './pages/CustomerDashboard';
import MyRatingsPage from './pages/MyRatingsPage';
import StoreReviewsPage from './pages/StoreReviewsPage';

// ========================================
// MERCHANT PAGES
// ========================================
import MerchantDashboard from './pages/MerchantDashboard';
import MerchantPendingApprovalPage from './pages/MerchantPendingApprovalPage';
import MerchantRejectedPage from './pages/MerchantRejectedPage';

// ========================================
// ADMIN PAGES
// ========================================
import AdminDashboard from './pages/AdminDashboard';

// ========================================
// PROTECTED ROUTE COMPONENT
// ========================================
import ProtectedRoute from './components/ProtectedRoute';

import ComponentTestPage from './pages/ComponentTestPage';

function App() {
  return (

    <AuthProvider>
      {/* Toast notifications */}
      <Toaster 
        position="top-right"
        toastOptions={{
          duration: 3000,
          style: {
            background: '#363636',
            color: '#fff',
          },
          success: {
            duration: 3000,
            iconTheme: {
              primary: '#2D9D78',
              secondary: '#fff',
            },
          },
          error: {
            duration: 4000,
            iconTheme: {
              primary: '#ef4444',
              secondary: '#fff',
            },
          },
        }}
      />

      <BrowserRouter>
        <Routes>
          {/* ========================================
              PUBLIC ROUTES (Authentication)
          ======================================== */}
          
          {/* Login */}
          <Route path="/login" element={<LoginPage />} />
          
          {/* Forgot Password */}
          <Route path="/forgot-password" element={<ForgotPasswordPage />} />
          
          {/* Reset Password */}
          <Route path="/reset-password" element={<ResetPasswordPage />} />
          
          
          {/* Register Merchant (3 steps) */}
          <Route path="/register/merchant" element={<RegisterMerchantPage />} />
          
          {/* Verify Email */}
          <Route path="/verify-email" element={<VerifyEmailPage />} />

          {/* ========================================
              CUSTOMER ROUTES (Protected)
          ======================================== */}
          
          {/* Customer Dashboard */}
          <Route 
            path="/dashboard" 
            element={
              <ProtectedRoute allowedRoles={['user']}>
                <CustomerDashboard />
              </ProtectedRoute>
            } 
          />
          
          {/* My Ratings */}
          <Route 
            path="/my-ratings" 
            element={
              <ProtectedRoute allowedRoles={['user']}>
                <MyRatingsPage />
              </ProtectedRoute>
            } 
          />
          
          {/* Store Reviews (Public - anyone can view) */}
          <Route path="/stores/:storeId/reviews" element={<StoreReviewsPage />} />

          {/* ========================================
              MERCHANT ROUTES (Protected)
          ======================================== */}
          
          {/* Merchant Dashboard */}
          <Route 
            path="/merchant/dashboard" 
            element={
              <ProtectedRoute allowedRoles={['merchant']}>
                <MerchantDashboard />
              </ProtectedRoute>
            } 
          />
          
          {/* Merchant Pending Approval */}
          <Route 
            path="/merchant/pending-approval" 
            element={
              <ProtectedRoute allowedRoles={['merchant']}>
                <MerchantPendingApprovalPage />
              </ProtectedRoute>
            } 
          />
          
          {/* Merchant Rejected */}
          <Route 
            path="/merchant/rejected" 
            element={
              <ProtectedRoute allowedRoles={['merchant']}>
                <MerchantRejectedPage />
              </ProtectedRoute>
            } 
          />

          {/* ========================================
              ADMIN ROUTES (Protected)
          ======================================== */}
          
          {/* Admin Dashboard */}
          <Route 
            path="/admin/dashboard" 
            element={
              <ProtectedRoute allowedRoles={['admin']}>
                <AdminDashboard />
              </ProtectedRoute>
            } 
          />

          {/* ========================================
              DEFAULT & 404 ROUTES
          ======================================== */}
          
          {/* Default route - redirect to login */}
          <Route path="/" element={<Navigate to="/login" replace />} />
          
          {/* 404 - redirect to login */}
          <Route path="*" element={<Navigate to="/login" replace />} />

          {/* Component Test Page - for development only */}
            <Route path="/test-components" element={<ComponentTestPage />} />
        </Routes>
      </BrowserRouter>
    </AuthProvider>
  );
}

export default App;
</file>

<file path="frontend/src/main.tsx">
import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import App from './App.tsx'
import './index.css'


createRoot(document.getElementById('root')!).render(
  <StrictMode>
    <App />
  </StrictMode>,
)
</file>

<file path="frontend/src/services/api.ts">
import axios from 'axios';
import type {
    ApiResponse,
    AuthResponse,
    LoginCredentials,
    RegisterCustomerData,
    RegisterMerchantStep1Data,
    RegisterMerchantStep2Data,
    RegisterMerchantStep3Data,
    ForgotPasswordData,
    ResetPasswordData,
    User,
    Store
} from '../@types';

const API_BASE_URL = import.meta.env.VITE_API_BASE_URL || 'http://localhost:3000/api';

console.log('===== API CONFIGURATION =====');
console.log('VITE_API_BASE_URL from env:', import.meta.env.VITE_API_BASE_URL);
console.log('API_BASE_URL being used:', API_BASE_URL);
console.log('============================');

const api = axios.create({
    baseURL: API_BASE_URL,
    headers:{
        'Content-Type': 'application/json'
    }
});

//Request interceptor(addtoken)
api.interceptors.request.use((config) => {
    const token = getToken();
    if (token) {
        config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
});

//response interceptor(handle errors)
api.interceptors.response.use(
    (response) => response,
    (error) => {
        if (error.response?.status === 401) {
            removeToken();
            removeUser();
            window.location.href = '/login';
        }
        return Promise.reject(error);
    }
);

export const setToken = (token: string): void => {
    localStorage.setItem('token', token);
}

export const getToken = (): string | null => {
    return localStorage.getItem('token');
}

export const removeToken = (): void => {
    localStorage.removeItem('token');
}

export const setUser = (user:User): void => {
    localStorage.setItem('user', JSON.stringify(user));
}

export const getUser = (): void | null =>{
    const user = localStorage.getItem('user');
    return user ? JSON.parse(user) : null;
}

export const removeUser = (): void => {
    localStorage.removeItem('user');
}

export const logout = (): void =>{
    removeToken();
    removeUser();
    window.location.href = '/login';
}

export const login = async (credentials: LoginCredentials): Promise<AuthResponse> => {
    const {data} = await api.post<ApiResponse<AuthResponse>>('/auth/login', credentials);
    return data.data!;
}

export const registerCustomer = async (userData: RegisterCustomerData): Promise<AuthResponse> => {
    const { data } = await api.post<ApiResponse<AuthResponse>>('/auth/register/user', userData);
    return data.data!;
};

export const registerMerchantStep1 = async (userData: RegisterMerchantStep1Data): Promise<AuthResponse> => {
    const { data } = await api.post<ApiResponse<AuthResponse>>('/auth/register/store/merchant', userData);
    return data.data!;
  };

export const registerMerchantStep2 = async (storeData: RegisterMerchantStep2Data) => {
const { data } = await api.post<ApiResponse>('/auth/register/store/info', storeData);
return data.data;
};
  
export const registerMerchantStep3 = async (verificationData: RegisterMerchantStep3Data) => {
const formData = new FormData();
formData.append('bankAccountNumber', verificationData.bankAccountNumber);

    if (verificationData.qrisImage) {
    formData.append('qrisImage', verificationData.qrisImage);
    }

    if (verificationData.idCardImage) {
        formData.append('idCardImage', verificationData.idCardImage);
    }

    const { data } = await api.post<ApiResponse>('/auth/register/store/verification', formData, {
        headers: { 'Content-Type': 'multipart/form-data' },
    });
    return data.data;
};

export const verifyEmail = async (token: string): Promise<User> => {
    const { data } = await api.post<ApiResponse<{ user: User }>>('/auth/verify-email', { token });
    return data.data!.user;
  };
  
export const resendVerification = async (email: string): Promise<void> => {
await api.post('/auth/resend-verification', { email });
};

export const forgotPassword = async (formData: ForgotPasswordData): Promise<void> => {
await api.post('/auth/forgot-password', formData);
};

export const resetPassword = async (formData: ResetPasswordData): Promise<void> => {
await api.post('/auth/reset-password', formData);
};

export const getProfile = async (): Promise<User> => {
const { data } = await api.get<ApiResponse<{ user: User }>>('/auth/profile');
return data.data!.user;
};

export const getMerchantStore = async(): Promise<Store> =>{
    const {data} = await api.get('/merchant/store');
    return data.data;
}



export default api;
</file>

<file path="backend/src/server.js">
require ('dotenv').config();
const express = require('express');
const cors = require('cors');
const authRoutes = require('./routes/authRoutes');
const storeRoutes = require('./routes/storeRoutes');
const app = express()
const PORT = process.env.PORT || 3000;


// cors copnfiguration
app.use(cors({
    origin: 'http://localhost:5173', // Frontend URL
    credentials: true,
    methods: ['GET', 'POST', 'PUT', 'PATCH', 'DELETE', 'OPTIONS'],
    allowedHeaders: ['Content-Type', 'Authorization']
  }));

//MiddleWare
app.use(express.json());
app.use(express.urlencoded({extended: true}));

//Routes
app.use('/api/auth', authRoutes);
app.use('/api', storeRoutes);

//API check
app.get('/', (req, res) => {
    res.json({
        success: true,
        message: 'API is running succesfully',
        timestamp: new Date().toISOString()
    });
});

//404 handler
app.use((req,res) =>{
    res.status(404).json({
        success: false,
        message: 'Route not found'
    });
})

//Error handler
app.use((err, req, res, next) =>{
    console.error(err.stack);
    res.status(500).json({
        success: false,
        message: 'Something went wrong!'
    });
});

app.listen (PORT, () => {
    console.log(`Server is running on port ${PORT}`);
});
</file>

<file path="backend/schema.sql">
-- Enable UUID extension
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- Drop tables if exists (untuk clean start)
DROP TABLE IF EXISTS stores CASCADE;
DROP TABLE IF EXISTS users CASCADE;

-- USERS TABLE
CREATE TABLE users (
    user_id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    email VARCHAR(255) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    name VARCHAR(255) NOT NULL,
    phone VARCHAR(20) NOT NULL,
    role VARCHAR(20) NOT NULL CHECK (role IN ('user', 'merchant', 'admin')),
    is_verified BOOLEAN DEFAULT false,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Merchant TABLE (untuk Merchant)
CREATE TABLE stores (
    store_id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    merchant_id UUID UNIQUE NOT NULL REFERENCES users(user_id) ON DELETE CASCADE,
    store_name VARCHAR(255) NOT NULL,
    description TEXT,
    logo_url VARCHAR(500),
    banner_url VARCHAR(500),
    address TEXT NOT NULL,
    city VARCHAR(100),
    latitude DECIMAL(10, 8) NOT NULL,
    longitude DECIMAL(11, 8) NOT NULL,
    phone VARCHAR(20),
    operating_hours VARCHAR(255),
    bank_account_number VARCHAR(50),
    qris_image_url VARCHAR(500),
    id_card_image_url VARCHAR(500),
    is_active BOOLEAN DEFAULT false,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Tambahan untuk stores table
ALTER TABLE stores
ADD COLUMN IF NOT EXISTS approval_status VARCHAR(50) DEFAULT 'pending';

ALTER TABLE stores
ADD COLUMN IF NOT EXISTS admin_notes TEXT;

ALTER TABLE stores
ADD COLUMN IF NOT EXISTS approved_at TIMESTAMP;

ALTER TABLE stores
ADD COLUMN IF NOT EXISTS approved_by UUID REFERENCES users(user_id);

UPDATE stores
SET approval_status = 'approved', is_active = true
WHERE approval_status IS NULL OR approval_status = '';

CREATE INDEX IF NOT EXISTS idx_stores_approval_status ON stores(approval_status)


-- Indexes
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_users_role ON users(role);
CREATE INDEX idx_stores_merchant ON stores(merchant_id);

-- INSERT INTO users (email, password, name, phone, role, is_verified) 
-- VALUES (
--     'admin@bakery.com', 
--     '$2a$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', 
--     'Admin', 
--     '081234567890', 
--     'admin', 
--     true
-- );
</file>

</files>
